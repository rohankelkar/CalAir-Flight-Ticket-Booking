<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Air California</title>

    <style>
      .modal-dialog {
        position:absolute;
        top:50% !important;
        transform: translate(0, -50%) !important;
        -ms-transform: translate(0, -50%) !important;
        -webkit-transform: translate(0, -50%) !important;
        margin:auto 5%;
        width:90%;
        height:80%;
      }
      .modal-content {
        min-height:100%;
        position:absolute;
        top:0;
        bottom:0;
        left:0;
        right:0;
      }
      .modal-body {
        position:absolute;
        top:45px; /** height of header **/
        bottom:45px;  /** height of footer **/
        left:0;
        right:0;
        overflow-y:auto;
      }
      .modal-footer {
        position:absolute;
        bottom:0;
        left:0;
        right:0;
      }
    </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>


    <!-- Bootstrap core CSS -->
    <link href="https://getbootstrap.com/docs/3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="https://getbootstrap.com/docs/3.3/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="https://getbootstrap.com/docs/3.3/assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom styles for this template -->
    <link href="carousel.css" rel="stylesheet">
  </head>
<!-- NAVBAR
================================================== -->
  <body>

    <div id="notification_bar" class="alert">
      <hr class="featurette-divider">
      <span id="notification_bar_text"> </span>
    </div>
    <div class="navbar-wrapper">
      <div class="container">
        <nav class="navbar navbar-inverse navbar-static-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a id="logo_button" class="navbar-brand" href="#"><img style="width: 134px;height: 60px;" src="https://upload.wikimedia.org/wikipedia/en/thumb/9/93/AirCal_logo.svg/500px-AirCal_logo.svg.png"/></a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li class="active"><a id="home_button" href="#">Home</a></li>
                <li><a id="login_button" href="#login">Log In</a></li>
                <li><a id="enroll_button" href="#enroll">Enroll</a></li>
                <li><a id="logout_button" href="#logout">Log Out</a></li>
                <li><a id="flight_search_button" href="#flight_search">Flight</a></li>
                <li><a href="#hotel_search">Hotel</a></li>
                <li><a href="#car_search">Car</a></li>
              </ul>
            </div>
          </div>
        </nav>

      </div>
    </div>


    <div id="flight_search_div">
    <!-- Carousel
    ================================================== -->
      <div id="myCarousel" class="carousel slide" data-ride="carousel">
      <!-- Indicators -->
      <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
      </ol>
      <div class="carousel-inner" role="listbox">
        <div class="item active">
          <img class="first-slide" src="https://www.visitburbank.com/wp-content/uploads/2016/06/hollywood-burbank-airport.jpg" alt="First slide">
          <div class="container">
            <div class="carousel-caption">
              <h1>Burbank</h1>
              <p>Note: If you're viewing this page via a <code>file://</code> URL, the "next" and "previous" Glyphicon buttons on the left and right might not load/display properly due to web browser security rules.</p>
              <p><a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a></p>
            </div>
          </div>
        </div>
        <div class="item">
          <img class="second-slide" src="https://res.cloudinary.com/simpleview/image/upload/c_fill,f_auto,h_405,q_60,w_1400/v1/clients/palmsprings/date_festival_web_hero_01b5249b-5b06-49ca-9914-7ac483186daf.jpg" alt="Second slide">
          <div class="container">
            <div class="carousel-caption">
              <h1>Palm Springs</h1>
              <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
              <p><a class="btn btn-lg btn-primary" href="#" role="button">Learn more</a></p>
            </div>
          </div>
        </div>
        <div class="item">
          <img class="third-slide" src="https://scontent-lax3-2.xx.fbcdn.net/v/t1.0-9/10806223_10154855424485578_4195230443764472452_n.jpg?_nc_cat=0&oh=ff485ba2783b188983fd8e8fda908a2f&oe=5B5B2E56" alt="Third slide">
          <div class="container">
            <div class="carousel-caption">
              <h1>San Diego</h1>
              <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
              <p><a class="btn btn-lg btn-primary" href="#" role="button">Browse gallery</a></p>
            </div>
          </div>
        </div>
      </div>
      <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div><!-- /.carousel -->


      <!-- Marketing messaging and featurettes
      ================================================== -->
      <!-- Wrap the rest of the page in another container to center all the content. -->

      <div class="container marketing">

      <!-- Three columns of text below the carousel -->
      <div class="row">
        <div class="col-lg-12">
          <div class="container">
            <form id="flight_search_form">
              <div class="form-group row">


                <label class="col-sm-1 col-form-label" for="depart_airport">Depart Airport</label>
                <!-- <label for="inputEmail3" class="col-sm-2 col-form-label">Email</label> -->
                <div class="col-sm-2">
                  <input type="text" class="form-control" id="depart_airport" placeholder="Return Airport">
                  <!-- <input class="form-control" id="date" name="depart_airport" placeholder="MM/DD/YYY" type="text"/> -->
                </div>
                <label class="col-sm-1 col-form-label" for="arrival_airport">Arrival Airport</label>
                <!-- <label for="inputEmail3" class="col-sm-2 col-form-label">Email</label> -->
                <div class="col-sm-2">
                  <input type="text" class="form-control" id="arrival_airport" placeholder="Arrival Airport">
                  <!-- <input class="form-control" id="date" name="depart_airport" placeholder="MM/DD/YYY" type="text"/> -->
                </div>

                <label class="col-sm-1 col-form-label" for="depart_date">Depart Date</label>
                <!-- <label for="inputEmail3" class="col-sm-2 col-form-label">Email</label> -->
                <div class="col-sm-2">
                  <input class="form-control" id="depart_date" name="depart_date" placeholder="MM/DD/YYY" type="date"/>
                </div>
              </div>
              <button type="submit" class="btn btn-primary">Search</button>
              <button type="reset" class="btn btn-primary">Reset</button>
            </form>
          </div>

        </div>
      </div><!-- /.row -->

      <!-- /END THE FEATURETTES -->

      </div><!-- /.container -->
    </div>
    <div class="container" id="flight_search_result_div">
      <hr class="featurette-divider">
      <table class="table" id="flight_search_result_table">
        <thead>
          <tr>
            <th scope="col">Flight#</th>
            <th scope="col">From</th>
            <th scope="col">To</th>
            <th scope="col">Date</th>
            <th scope="col">Time</th>
            <th scope="col">Book</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>

    </div>
    <div class="container" id="enroll_div">
      <hr class="featurette-divider">
      <form id="enroll_form">
        <div class="form-group row">
          <label for="example-text-input" class="col-2 col-form-label">Customer Username</label>
          <div class="col-10">
            <input class="form-control" type="text" value="Artisanal kale" id="customer_username">
          </div>
        </div>
        <div class="form-group row">
          <label for="example-email-input" class="col-2 col-form-label">Email</label>
          <div class="col-10">
            <input class="form-control" type="email" value="bootstrap@example.com" id="customer_email">
          </div>
        </div>
        <div class="form-group row">
          <label for="example-tel-input" class="col-2 col-form-label">Telephone</label>
          <div class="col-10">
            <input class="form-control" type="tel" value="1-(555)-555-5555" id="customer_telephone">
          </div>
        </div>
        <div class="form-group row">
          <label for="example-password-input" class="col-2 col-form-label">Password</label>
          <div class="col-10">
            <input class="form-control" type="password" value="hunter2" id="customer_password">
          </div>
        </div>
          <button type="submit" class="btn btn-primary">Submit</button>
          <button type="reset" class="btn btn-primary">Reset</button>
      </form>
    </div>
    <div class="container" id="enroll_thank_you_register_div">
        <hr class="featurette-divider">
        <h1> Thank you for registering as a flyer member at Air California! </h1>
        <h2 class="text-center font-italic" id="thank_you_next_destination"> </h2>
    </div>
    <div class="container" id="login_div">
      <hr class="featurette-divider">
      <form id="login_form">
        <div class="form-group row">
          <label for="example-text-input" class="col-2 col-form-label">Customer Username</label>
          <div class="col-10">
            <input class="form-control" type="text" value="Artisanal kale" id="login_customer_username">
          </div>
        </div>
        <div class="form-group row">
          <label for="example-password-input" class="col-2 col-form-label">Password</label>
          <div class="col-10">
            <input class="form-control" type="password" value="hunter2" id="login_customer_password">
          </div>
        </div>
          <button type="submit" class="btn btn-primary">Submit</button>
          <button type="reset" class="btn btn-primary">Reset</button>
      </form>
    </div>

    <!-- Purchase or Login or Enroll Modal -->
    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modal_title"></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="modal_body">

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" value="" id="modal_button"></button>
          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="container">
      <footer>
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>&copy; 2018 Air California, Inc. &middot; <a href="#">Privacy</a> &middot; <a href="#">Terms</a></p>
      </footer>
    </div>

    <script>window.jQuery || document.write('<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"><\/script>')</script>
    <script src="https://getbootstrap.com/docs/3.3/dist/js/bootstrap.min.js"></script>
    <script src="https://getbootstrap.com/docs/3.3/assets/js/vendor/holder.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript">
    var user_profile = null;
    var next_destination = null;
    (function(){
      $("#notification_bar").hide();
      $("#logout_button").hide();
      flight_search_div_display();
    })();
    function enroll_display(){
      $("#flight_search_div").hide();
      $("#enroll_div").show();
      $("#enroll_thank_you_register_div").hide();
      $("#login_div").hide();
      $("#flight_search_result_div").hide();

    }
    function login_display(){
      $("#flight_search_div").hide();
      $("#enroll_div").hide();
      $("#enroll_thank_you_register_div").hide();
      $("#login_div").show();
      $("#flight_search_result_div").hide();

    }
    function flight_search_div_display(){
      $("#flight_search_div").show();
      $("#enroll_div").hide();
      $("#enroll_thank_you_register_div").hide();
      $("#login_div").hide();
      $("#flight_search_result_div").hide();
    }

    function thank_you_div_display(){
      $("#flight_search_div").hide();
      $("#enroll_div").hide();
      $("#login_div").hide();
      $("#enroll_thank_you_register_div").show();
    }

    function flight_search_result_display(){
      $("#notification_bar").hide();
      $("#flight_search_div").hide();
      $("#enroll_div").hide();
      $("#enroll_thank_you_register_div").hide();
      $("#login_div").hide();
      $("#flight_search_result_div").show();
    }
    function successful_login_display(){
      // console.log($("#logout_button"));

      $('#notification_bar').fadeIn("fast", function(){
        $("#notification_bar").fadeOut(4000);
      });
      $("#notification_bar").removeClass("alert-danger");
      $("#notification_bar").addClass("alert-success");
      $("#notification_bar_text").text("You have logged in as "+user_profile.username);

      login_nav_button_change();
    }
    function login_nav_button_change(){
      $("#logout_button").show();
      $("#login_button").hide();
      $("#enroll_button").hide();
    }
    function successful_logout_display(){
      $('#notification_bar').fadeIn("fast", function(){
        $("#notification_bar").fadeOut(4000);
      });
      $("#notification_bar").removeClass("alert-danger");
      $("#notification_bar").addClass("alert-success");
      $("#notification_bar_text").text("You have logged out successfully!");
      $("#logout_button").hide();
      $("#login_button").show();
      $("#enroll_button").show();
    }

    $("#flight_search_form").submit(function(e){
      e.preventDefault();
      var depart_airport = $('#depart_airport').val().trim();
      var arrival_airport = $('#arrival_airport').val().trim();
      var depart_date = $('#depart_date').val().trim();
      if(depart_airport.length == 0 || arrival_airport.length == 0 || depart_date.length == 0){
        alert("Search content is empty..");
        return;
      }
      $.ajax({
          type : 'GET',
          url : 'http://localhost:5000/'+depart_airport+'/'+arrival_airport+'/'+depart_date+'',
          success : function(data){
            if(data.response_status == 'Success'){
              flight_search_result_display();
              $.each(data.data, function( index, value ) {
                var append_string = "";
                if(user_profile != null && value.hasOwnProperty('passenger_id') && value.passenger_id[user_profile._id]){
                  append_string = "<tr><td scope='row'>"+value._id+"</td><td>"+value.from+"</td><td>"+value.to+"</td><td>"+value.date+"</td><td>"+value.time+"</td><td><button type='button' class='btn btn-primary disabled'> BOUGHT </button></td>";
                }else{
                  append_string = "<tr><td scope='row'>"+value._id+"</td><td>"+value.from+"</td><td>"+value.to+"</td><td>"+value.date+"</td><td>"+value.time+"</td><td><button onclick='purchase_check_login(\""+value._id+"\",\""+value.date+"\")' type='button' class='btn btn-primary' data-toggle='modal' data-target='#modal'> USD$100</button></td>";
                }
                $("#flight_search_result_table tbody").append(append_string);
              });
          }
        }
      })
    });


    $("#login_form").submit(function(){
      var prompted_password = $('#login_customer_password').val().trim();
      var prompted_username = $('#login_customer_username').val().trim();
      $.ajax({
          type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
          url         : 'http://localhost:4000/'+prompted_username, // the url where we want to POST
          dataType    : 'json', // what type of data do we expect back from the server
          encode      : true,
          success : function(data) {
            if(data.response_status == 'Success' && data.data.length > 0 && data.data[0].password.localeCompare(prompted_username)){
              user_profile = data.data[0];
              flight_search_div_display();
              successful_login_display();
            }else{
              $('#notification_bar').fadeIn("fast", function(){
                $("#notification_bar").fadeOut(4000);
              });
              $("#notification_bar").removeClass("alert-success");
              $("#notification_bar").addClass("alert-danger");
              $("#notification_bar_text").text("The combination of username and password is incorrect.!");
            }
          }
      });
    });
    $("#enroll_form").submit(function(){
      var formData = {
          'username' : $('#customer_username').val(),
          'email' : $('#customer_email').val(),
          'telephone': $('#customer_telephone').val(),
          'password': $('#customer_password').val()
      };
      // process the form
        $.ajax({
            type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
            url         : 'http://localhost:4000/'+formData.username+'/'+formData.password, // the url where we want to POST
            data        : formData, // our data object
            dataType    : 'json', // what type of data do we expect back from the server
            encode      : true,
            success     :  function(data) {
              if(data.response_status == 'Success'){
                thank_you_div_display();
                user_profile = data;
                console.log(user_profile);
                //redirect to next destination
                if(next_destination != null){
                  if(next_destination == "flight_search_result_div"){
                    next_destination = null;
                    $("#thank_you_next_destination").text("You are now redirected to finishing booking!");
                    setTimeout(function () {
                      flight_search_result_display();
                      $("#thank_you_next_destination").text("");
                    }, 5000);
                  }
                }

              }
            }
        })
    });

    function purchase_check_login(flight_id, date){
      if(user_profile == null){
        login_modal(flight_id, date);
      }else{
        purchase_modal(flight_id, date);
      }
    }
    function login_modal(flight_id, date){
      var login_modal_body = '<div class="container col-sm-8">';
      login_modal_body += '<div class="form-group row"><label for="example-text-input" class="col-2 col-form-label">Customer Username</label><div class="col-10"><input class="form-control" type="text" value="Artisanal kale" id="login_modal_customer_username"></div></div>';
      login_modal_body += '<div class="form-group row"><label for="example-password-input" class="col-2 col-form-label">Password</label><div class="col-10"><input class="form-control" type="password" value="hunter2" id="login_modal_customer_password"></div></div>';
      login_modal_body += '<div class="form-group row"><a onclick="login_modal_enroll()" href=\"#\"> Have not registered? Please enroll to our wonderful membership program!</a></div></div>';
      login_modal_body += '<input type="hidden" name="login_flight_id" id="login_flight_id" value="'+flight_id+'">';
      login_modal_body += '<input type="hidden" name="login_date" id="login_date" value="'+date+'">';
      $("#modal_button").text('Login');
      $("#modal_body").html(login_modal_body);
      $("#modal_title").text('Login to continue booking');
    }
    function purchase_modal(flight_id, date){
      var purchase_modal_body = '<img src="https://www.bankofamerica.com/content/images/ContextualSiteGraphics/CreditCardArt/en_US/Approved_PCM/8blm_trvsigcm_v_250x158.png"/>'
      purchase_modal_body += '<div class="container col-sm-8"><div class="form-group row"><label for="example-text-input" class="col-2 col-form-label">Customer Username on card</label><input class="form-control" type="text" value="Artisanal kale" id="purchase_modal_credit_card_name"></div>';
      purchase_modal_body += '<div class="form-group row"><label for="purchase_modal_credit_card_number" class="col-2 col-form-label">Credit Card Number</label><input class="form-control" type="text" value="hunter2" id="purchase_modal_credit_card_number"></div>';
      purchase_modal_body += '<div class="form-group row"><label for="purchase_modal_credit_card_number" class="col-2 col-form-label">Zip Code</label><input class="form-control" type="text" value="hunter2" id="purchase_modal_credit_card_zip_code"></div>';
      purchase_modal_body += '<div class="form-group row"><label for="purchase_modal_credit_card_security_code" class="col-2 col-form-label">Credit Card Security Code</label><input class="form-control" type="text" value="hunter2" id="purchase_modal_credit_card_security_code"></div></div>';
      purchase_modal_body += '<input type="hidden" name="purchase_flight_id" id="purchase_flight_id" value="'+flight_id+'">';
      purchase_modal_body += '<input type="hidden" name="purchase_date" id="purchase_date" value="'+date+'">';

      $("#modal_button").text('Purchase');
      $("#modal_body").html(purchase_modal_body);
      $("#modal_title").text('Book to have a wonderful journey');
    }


    $("#modal_button").click(function(){
      if(user_profile == null){
        // do login
        var prompted_password = $('#login_modal_customer_password').val().trim();
        var prompted_username = $('#login_modal_customer_username').val().trim();
        $.ajax({
            type        : 'GET', // define the type of HTTP verb we want to use (POST for our form)
            url         : 'http://localhost:4000/'+prompted_username, // the url where we want to POST
            success     : function(data) {
              if(data.response_status == 'Success' && data.data.length > 0 && data.data[0].password.localeCompare(prompted_username)){
                user_profile = data.data[0];
                //continue to purchase.
                purchase_modal($('#login_flight_id').val(), $('#login_date').val());
                login_nav_button_change();
              }else{
                $('#notification_bar').fadeIn("fast", function(){
                  $("#notification_bar").fadeOut(4000);
                });
                $("#notification_bar").removeClass("alert-success");
                $("#notification_bar").addClass("alert-danger");
                $("#notification_bar_text").text("The combination of username and password is incorrect.!");
              }
            }
        });
      }else{
        //   post('/:username/:flight_id/:departure_date', async (req, res, next) => {c
        $.ajax({
            type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
            url         : 'http://localhost:3000/'+user_profile._id+'/'+$("#purchase_flight_id").val()+'/'+$("#purchase_date").val(), // the url where we want to POST
            success     : function(data) {
              console.log(data);
              if(data.response_status == 'Success' && data.data.length > 0 && data.data[0].password.localeCompare(prompted_username)){
                user_profile = data.data[0];
                //continue to purchase.
                purchase_modal($('#login_flight_id').val(), $('#login_date').val());
                login_nav_button_change();
              }else{
                $('#notification_bar').fadeIn("fast", function(){
                  $("#notification_bar").fadeOut(4000);
                });
                $("#notification_bar").removeClass("alert-success");
                $("#notification_bar").addClass("alert-danger");
                $("#notification_bar_text").text("The combination of username and password is incorrect.!");
              }
            },error: function(data){
              console.log(data);
            }
        });

      }
    });

    function login_modal_enroll(){
      console.log("login_modal_enroll");
      close_modal();
      enroll_display();
      next_destination = "flight_search_result_div";
    }
    function close_modal(){
      $("#modal").modal('toggle');
    }
    $("#logout_button").click(function() {
      successful_logout_display();
      user_profile = null;
    });
    $("#enroll_button").click(function() {
      enroll_display();
    });
    $("#login_button").click(function() {
      login_display();
    });

    $("#home_button").click(function() {
      flight_search_div_display();
    });

    $("#logo_button").click(function() {
      flight_search_div_display();
    });

    </script>
  </body>
</html>
